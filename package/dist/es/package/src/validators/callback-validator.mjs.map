{"version":3,"file":"callback-validator.mjs","sources":["../../../../../src/validators/callback-validator.ts"],"sourcesContent":["import { getCookie } from \"hono/cookie\";\nimport { z } from \"zod\";\nimport { zValidator } from \"@hono/zod-validator\";\n\nconst callbackQuerySchema = z.object({\n\tcode: z.string({ message: \"Missing code query.\" }),\n\tstate: z.string({ message: \"Missing state query.\" }),\n});\n\nconst callbackCookieSchema = z.object({\n\tauth_state: z.string({\n\t\tmessage: \"Missing cookie state cookie.\",\n\t}),\n\tprovider: z.string({\n\t\tmessage: \"Missing provider information cookie.\",\n\t}),\n});\n\n// Validates callback query parameters and verifies state parameter to prevent CSRF attacks\nexport const callbackQueryValidator = zValidator(\"query\", callbackQuerySchema, (result, c) => {\n\tconst authState = getCookie(c, \"auth_state\");\n\n\tif (result.data.state !== authState) {\n\t\treturn c.text(\n\t\t\t\"A security issue was detected (CSRF attack). Please restart the authentication process and try again.\",\n\t\t\t{ status: 403 },\n\t\t);\n\t}\n\n\tif (!result.success) return c.text(result.error.issues[0].message, { status: 422 });\n});\n\n// Validates presence of required cookies set during auth initialization\nexport const callbackCookieValidator = zValidator(\"cookie\", callbackCookieSchema, (result, c) => {\n\tif (!result.success) {\n\t\treturn c.text(result.error.issues[0].message, { status: 422 });\n\t}\n});\n"],"names":["callbackQuerySchema","z","callbackCookieSchema","callbackQueryValidator","zValidator","result","c","authState","getCookie","callbackCookieValidator"],"mappings":";;;AAIA,MAAMA,IAAsBC,EAAE,OAAO;AAAA,EACpC,MAAMA,EAAE,OAAO,EAAE,SAAS,uBAAuB;AAAA,EACjD,OAAOA,EAAE,OAAO,EAAE,SAAS,uBAAwB,CAAA;AACpD,CAAC,GAEKC,IAAuBD,EAAE,OAAO;AAAA,EACrC,YAAYA,EAAE,OAAO;AAAA,IACpB,SAAS;AAAA,EAAA,CACT;AAAA,EACD,UAAUA,EAAE,OAAO;AAAA,IAClB,SAAS;AAAA,EACT,CAAA;AACF,CAAC,GAGYE,IAAyBC,EAAW,SAASJ,GAAqB,CAACK,GAAQC,MAAM;AACvF,QAAAC,IAAYC,EAAUF,GAAG,YAAY;AAEvC,MAAAD,EAAO,KAAK,UAAUE;AACzB,WAAOD,EAAE;AAAA,MACR;AAAA,MACA,EAAE,QAAQ,IAAI;AAAA,IACf;AAGD,MAAI,CAACD,EAAO,QAAS,QAAOC,EAAE,KAAKD,EAAO,MAAM,OAAO,CAAC,EAAE,SAAS,EAAE,QAAQ,KAAK;AACnF,CAAC,GAGYI,IAA0BL,EAAW,UAAUF,GAAsB,CAACG,GAAQC,MAAM;AAC5F,MAAA,CAACD,EAAO;AACJ,WAAAC,EAAE,KAAKD,EAAO,MAAM,OAAO,CAAC,EAAE,SAAS,EAAE,QAAQ,IAAA,CAAK;AAE/D,CAAC;"}