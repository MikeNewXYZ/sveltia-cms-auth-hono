{"version":3,"file":"callback-validator.cjs","sources":["../../../../../src/validators/callback-validator.ts"],"sourcesContent":["import { getCookie } from \"hono/cookie\";\nimport { z } from \"zod\";\nimport { zValidator } from \"@hono/zod-validator\";\n\nconst callbackQuerySchema = z.object({\n\tcode: z.string({ message: \"Missing code query.\" }),\n\tstate: z.string({ message: \"Missing state query.\" }),\n});\n\nconst callbackCookieSchema = z.object({\n\tauth_state: z.string({\n\t\tmessage: \"Missing cookie state cookie.\",\n\t}),\n\tprovider: z.string({\n\t\tmessage: \"Missing provider information cookie.\",\n\t}),\n});\n\n// Validates callback query parameters and verifies state parameter to prevent CSRF attacks\nexport const callbackQueryValidator = zValidator(\"query\", callbackQuerySchema, (result, c) => {\n\tconst authState = getCookie(c, \"auth_state\");\n\n\tif (result.data.state !== authState) {\n\t\treturn c.text(\n\t\t\t\"A security issue was detected (CSRF attack). Please restart the authentication process and try again.\",\n\t\t\t{ status: 403 },\n\t\t);\n\t}\n\n\tif (!result.success) return c.text(result.error.issues[0].message, { status: 422 });\n});\n\n// Validates presence of required cookies set during auth initialization\nexport const callbackCookieValidator = zValidator(\"cookie\", callbackCookieSchema, (result, c) => {\n\tif (!result.success) {\n\t\treturn c.text(result.error.issues[0].message, { status: 422 });\n\t}\n});\n"],"names":["callbackQuerySchema","z","callbackCookieSchema","callbackQueryValidator","zValidator","result","c","authState","getCookie","callbackCookieValidator"],"mappings":"qZAIMA,EAAsBC,UAAE,OAAO,CACpC,KAAMA,EAAAA,QAAE,OAAO,CAAE,QAAS,sBAAuB,EACjD,MAAOA,EAAAA,QAAE,OAAO,CAAE,QAAS,sBAAwB,CAAA,CACpD,CAAC,EAEKC,EAAuBD,UAAE,OAAO,CACrC,WAAYA,UAAE,OAAO,CACpB,QAAS,8BAAA,CACT,EACD,SAAUA,UAAE,OAAO,CAClB,QAAS,sCACT,CAAA,CACF,CAAC,EAGYE,EAAyBC,EAAW,WAAA,QAASJ,EAAqB,CAACK,EAAQC,IAAM,CACvF,MAAAC,EAAYC,EAAAA,UAAUF,EAAG,YAAY,EAEvC,GAAAD,EAAO,KAAK,QAAUE,EACzB,OAAOD,EAAE,KACR,wGACA,CAAE,OAAQ,GAAI,CACf,EAGD,GAAI,CAACD,EAAO,QAAS,OAAOC,EAAE,KAAKD,EAAO,MAAM,OAAO,CAAC,EAAE,QAAS,CAAE,OAAQ,IAAK,CACnF,CAAC,EAGYI,EAA0BL,EAAW,WAAA,SAAUF,EAAsB,CAACG,EAAQC,IAAM,CAC5F,GAAA,CAACD,EAAO,QACJ,OAAAC,EAAE,KAAKD,EAAO,MAAM,OAAO,CAAC,EAAE,QAAS,CAAE,OAAQ,GAAA,CAAK,CAE/D,CAAC"}